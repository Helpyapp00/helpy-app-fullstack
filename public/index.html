<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helpy - Feed</title>
    <link rel="icon" href="/public/icons/helpy.ico" type="image/x-icon">
    
    <!-- üîí VERIFICA√á√ÉO DE AUTENTICA√á√ÉO - DEVE SER A PRIMEIRA COISA, ANTES DE QUALQUER CSS -->
    <script>
        // Executa IMEDIATAMENTE, antes de qualquer coisa - BLOQUEIA o carregamento se n√£o autenticado
        (function() {
            // Verifica se est√° em p√°gina de login/cadastro
            const pathname = window.location.pathname || window.location.href || '';
            const isLoginPage = pathname === '/login' || 
                               pathname === '/cadastro' ||
                               pathname.endsWith('/login') || 
                               pathname.endsWith('/cadastro') ||
                               pathname.includes('login.html') ||
                               pathname.includes('cadastro.html') ||
                               window.location.href.includes('/login') ||
                               window.location.href.includes('/cadastro');
            
            // Se N√ÉO estiver na p√°gina de login/cadastro, verifica autentica√ß√£o
            if (!isLoginPage) {
                const token = localStorage.getItem('jwtToken');
                const userId = localStorage.getItem('userId');
                
                // Se n√£o estiver autenticado, redireciona IMEDIATAMENTE e PARA tudo
                if (!token || !userId) {
                    // Usa replace para n√£o adicionar ao hist√≥rico
                    window.location.replace('/login');
                    // Tenta parar qualquer processamento adicional
                    if (window.stop) {
                        window.stop();
                    }
                    // Retorna false para tentar parar execu√ß√£o
                    return false;
                }
            }
            return true;
        })();
    </script>
    
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <!-- üõë NOVO: Script de Tema (Deve vir ANTES de todo o conte√∫do) -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                // Aplica a classe no <html> para :root funcionar
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>

    <header>
        <div class="logo-box">
            <img src="imagens/helpy-feed.png" alt="Logo Helpy"> <h1>Helpy</h1>
        </div>
        <input type="text" class="search" placeholder="Buscar servi√ßos ou profissionais...">
        <div class="user-info">
            <!-- üîî NOVO: √çcone de Notifica√ß√µes -->
            <div id="notificacoes-container" style="position: relative; margin-right: 15px;">
                <button id="btn-notificacoes" style="background: none; border: none; cursor: pointer; font-size: 20px; color: var(--text-primary); position: relative;">
                    <i class="fas fa-bell"></i>
                    <span id="badge-notificacoes" style="position: absolute; top: -5px; right: -5px; background: #dc3545; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; display: none; align-items: center; justify-content: center;">0</span>
                </button>
            </div>
            <img id="user-avatar-header" src="imagens/default-user.png" alt="Avatar do Usu√°rio" class="user-avatar-header">
            <span id="user-name-header"></span>
            <button id="profile-button">Meu Perfil</button>
            <button id="logout-button">Sair</button>
        </div>
    </header>

    <div class="conteudo">
        <aside class="categorias">
            <h2>Filtros</h2>
            <p>Ver postagens de:</p>
            <div class="filtro-botoes">
                <button id="filter-todos" class="filtro-btn ativo">
                    <i class="fas fa-globe-americas"></i> Todos
                </button>
                <button id="filter-trabalhadores" class="filtro-btn">
                    <i class="fas fa-briefcase"></i> Profissionais
                </button>
                <button id="filter-clientes" class="filtro-btn">
                    <i class="fas fa-users"></i> Clientes
                </button>
            </div>
            
            <div class="filtro-localizacao">
                <h4>Localiza√ß√£o</h4>
                <input type="text" id="filtro-cidade" placeholder="Digite a cidade...">
                <button id="filtro-cidade-btn">Buscar</button>
            </div>

            <!-- üÜï NOVO: Bot√£o "Preciso agora!" na lateral -->
            <div class="filtro-acoes-rapidas">
                <h4>A√ß√µes R√°pidas</h4>
                <button id="btn-preciso-agora" class="btn-preciso-agora-lateral">
                    <i class="fas fa-bolt"></i> Preciso agora!
                </button>
            </div>

            <!-- üÜï NOVO: Se√ß√£o de Times Locais na lateral -->
            <div class="filtro-times-locais">
                <div class="section-header-lateral">
                    <h4><i class="fas fa-users"></i> Times Locais</h4>
                    <button id="btn-criar-time" class="btn-criar-time-lateral" title="Montar Time">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div id="times-container" class="times-container-lateral">
                    <!-- Times ser√£o carregados aqui -->
                </div>
            </div>

            <!-- üÜï REORGANIZADO: Configura√ß√µes sempre por √∫ltimo -->
            <div class="filtro-configuracoes">
                <h4>Configura√ß√µes</h4>
                <!-- üõë ATUALIZA√á√ÉO: Links funcionais -->
                <a href="/configuracoes-conta" class="filtro-config-btn">
                    <i class="fas fa-user-cog"></i> Conta
                </a>
                <a href="/configuracoes-privacidade" class="filtro-config-btn">
                    <i class="fas fa-shield-alt"></i> Privacidade
                </a>
                <div class="filtro-config-item">
                    <span>
                        <i class="fas fa-palette"></i> Tema
                    </span>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

        </aside>

        <main>
            <section class="publicar">
                <h2>Crie uma Publica√ß√£o</h2>
                <form id="new-post-form">
                    <textarea id="post-content-input" placeholder="No que voc√™ est√° pensando?"></textarea>
                    <div class="botoes-postar">
                        <div class="upload-area">
                            <label for="post-media-input" class="upload-button">
                                <i class="fas fa-camera"></i> Adicionar M√≠dia
                            </label>
                            <input type="file" id="post-media-input" accept="image/*,video/mp4,video/webm,video/quicktime">
                            
                            <!-- üÜï NOVO: Preview de m√≠dia melhorado -->
                            <div id="media-preview-container" class="media-preview-container oculto">
                                <button type="button" class="btn-remover-preview" id="btn-remover-preview">&times;</button>
                                <img id="image-preview" class="image-preview oculto" src="#" alt="Pr√©-visualiza√ß√£o">
                                <video id="video-preview" class="video-preview oculto" controls muted></video>
                                <span id="media-filename" class="filename-display"></span>
                            </div>
                        </div>
                        <button type="submit" class="btn-enviar">Publicar</button>
                    </div>
                    <div id="post-form-message" class="form-message hidden"></div>
                </form>
            </section>

            <section id="posts-container">
                <!-- Postagens ser√£o carregadas aqui -->
            </section>
        </main>

        <aside class="anuncio">
            <h3>An√∫ncios</h3>
            <div class="caixa-anuncio">
                Espa√ßo para An√∫ncios
            </div>
        </aside>
    </div>

    <!-- Modais (Popup e Logout) -->
    <div id="popup-escolha" class="popup-escolha oculto">
        <div class="popup-conteudo">
            <h3>Voc√™ √© um Cliente ou um Trabalhador?</h3>
            <button id="btn-cliente">Sou Cliente</button>
            <button id="btn-trabalhador">Sou Trabalhador</button>
        </div>
    </div>

    <div id="logout-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Tem certeza que deseja sair?</h3>
            <div class="modal-buttons">
                <button id="confirm-logout-yes" class="btn-confirm-yes">Sim</button>
                <button id="confirm-logout-no" class="btn-confirm-no">N√£o</button>
            </div>
        </div>
    </div>

    <!-- üÜï NOVO: Modal "Preciso agora!" - Profissionais Pr√≥ximos -->
    <div id="modal-preciso-agora" class="modal-overlay hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-briefcase"></i> Profissionais Pr√≥ximos</h3>
                <button class="btn-close-modal" data-modal="modal-preciso-agora">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <p style="margin: 0 0 10px 0; font-weight: 600; color: var(--text-primary);">
                        <i class="fas fa-info-circle"></i> Precisa de um servi√ßo urgente?
                    </p>
                    <button id="btn-procurar-clientes" class="btn-primary" style="width: 100%;">
                        <i class="fas fa-bolt"></i> Criar Pedido Urgente
                    </button>
                </div>
                
                <div class="filtro-servico" style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
                        <i class="fas fa-search"></i> Buscar Profissionais
                    </label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="filtro-tipo-servico" placeholder="Tipo de servi√ßo (ex: encanador, eletricista)" style="flex: 1;">
                        <button id="btn-buscar-proximos" class="btn-primary">Buscar</button>
                    </div>
                </div>
                
                <div class="filtro-selo-qualidade" style="margin-bottom: 15px;">
                    <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="filtro-selo-qualidade"> 
                        <span>Apenas com Selo de Qualidade Helpy üõ°Ô∏è</span>
                    </label>
                </div>
                
                <div id="profissionais-proximos" class="profissionais-lista">
                    <!-- Profissionais ser√£o carregados aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- üÜï NOVO: Modal Criar Time de Projeto -->
    <div id="modal-criar-time" class="modal-overlay hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> Montar Time de Projeto</h3>
                <button class="btn-close-modal" data-modal="modal-criar-time">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-criar-time">
                    <div class="form-group">
                        <label>T√≠tulo do Projeto</label>
                        <input type="text" id="time-titulo" required placeholder="Ex: Obra em Residencial">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea id="time-descricao" required placeholder="Descreva o projeto..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Bairro</label>
                        <input type="text" id="time-bairro" required>
                    </div>
                    <div class="form-group">
                        <label>Cidade</label>
                        <input type="text" id="time-cidade" required>
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <input type="text" id="time-estado" required maxlength="2" placeholder="SP">
                    </div>
                    <div class="form-group">
                        <label>Profissionais Necess√°rios</label>
                        <div id="profissionais-lista">
                            <div class="profissional-item">
                                <input type="text" placeholder="Tipo (ex: pedreiro)" class="tipo-profissional" required>
                                <input type="number" placeholder="Qtd" class="qtd-profissional" min="1" value="1" required>
                                <button type="button" class="btn-remover-profissional">&times;</button>
                            </div>
                        </div>
                        <button type="button" id="btn-adicionar-profissional" class="btn-secondary">+ Adicionar Profissional</button>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Criar Time</button>
                        <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-criar-time">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- üö® NOVO: Modal Pedido Urgente -->
    <div id="modal-pedido-urgente" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Preciso Agora!</h3>
                <button class="btn-close-modal" data-modal="modal-pedido-urgente">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; color: var(--text-primary);">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Profissionais online ser√£o notificados</strong> e voc√™ receber√° propostas em minutos!
                    </p>
                </div>
                
                <form id="form-pedido-urgente">
                    <div class="form-group">
                        <label><i class="fas fa-tools"></i> Qual servi√ßo voc√™ precisa?</label>
                        <input type="text" id="pedido-servico" placeholder="Ex: Montar guarda-roupa" required>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-tags"></i> Categoria</label>
                        <select id="pedido-categoria" required>
                            <option value="">Selecione...</option>
                            <option value="montagem">Montagem</option>
                            <option value="pintura">Pintura</option>
                            <option value="eletricista">Eletricista</option>
                            <option value="encanador">Encanador</option>
                            <option value="jardinagem">Jardinagem</option>
                            <option value="limpeza">Limpeza</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Descri√ß√£o (opcional)</label>
                        <textarea id="pedido-descricao" placeholder="Descreva melhor o que precisa..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-image"></i> Foto do Servi√ßo (opcional)</label>
                        <input type="file" id="pedido-foto" accept="image/*" style="display: none;">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button type="button" id="btn-selecionar-foto-pedido" class="btn-secondary" style="flex-shrink: 0;">
                                <i class="fas fa-upload"></i> Selecionar Foto
                            </button>
                            <div id="preview-foto-pedido" style="display: none; position: relative;">
                                <img id="img-preview-pedido" src="" alt="Preview" style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid var(--border-color);">
                                <button type="button" id="btn-remover-foto-pedido" style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px;">&times;</button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="border-top: 2px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                        <h4 style="margin-bottom: 15px; color: var(--text-primary);">
                            <i class="fas fa-map-marker-alt"></i> Localiza√ß√£o
                        </h4>
                        
                        <div class="form-group">
                            <label>Endere√ßo</label>
                            <input type="text" id="pedido-endereco" placeholder="Rua, n√∫mero, bairro" required>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Cidade</label>
                                <input type="text" id="pedido-cidade" required>
                            </div>
                            <div class="form-group">
                                <label>Estado</label>
                                <select id="pedido-estado" required>
                                    <option value="">Selecione...</option>
                                    <option value="AC">AC</option>
                                    <option value="AL">AL</option>
                                    <option value="AP">AP</option>
                                    <option value="AM">AM</option>
                                    <option value="BA">BA</option>
                                    <option value="CE">CE</option>
                                    <option value="DF">DF</option>
                                    <option value="ES">ES</option>
                                    <option value="GO">GO</option>
                                    <option value="MA">MA</option>
                                    <option value="MT">MT</option>
                                    <option value="MS">MS</option>
                                    <option value="MG">MG</option>
                                    <option value="PA">PA</option>
                                    <option value="PB">PB</option>
                                    <option value="PR">PR</option>
                                    <option value="PE">PE</option>
                                    <option value="PI">PI</option>
                                    <option value="RJ">RJ</option>
                                    <option value="RN">RN</option>
                                    <option value="RS">RS</option>
                                    <option value="RO">RO</option>
                                    <option value="RR">RR</option>
                                    <option value="SC">SC</option>
                                    <option value="SP">SP</option>
                                    <option value="SE">SE</option>
                                    <option value="TO">TO</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-pedido-urgente">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-paper-plane"></i> Enviar Pedido
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- üö® NOVO: Modal Ver Propostas -->
    <div id="modal-propostas" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-hand-holding-usd"></i> Propostas Recebidas</h2>
            <div id="lista-propostas" class="lista-propostas">
                <p>Carregando propostas...</p>
            </div>
        </div>
    </div>

    <!-- üè¢ NOVO: Modal Criar Time Local -->
    <div id="modal-criar-time-local" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-users"></i> Criar Time Local</h2>
            <form id="form-criar-time-local">
                <div class="form-group">
                    <label>Nome do Time</label>
                    <input type="text" id="time-nome" placeholder="Ex: Time de Pintura JF" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea id="time-descricao" placeholder="Descreva seu time..."></textarea>
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="time-categoria" required>
                        <option value="">Selecione...</option>
                        <option value="construcao">Constru√ß√£o</option>
                        <option value="pintura">Pintura</option>
                        <option value="jardinagem">Jardinagem</option>
                        <option value="limpeza">Limpeza</option>
                        <option value="montagem">Montagem</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Criar Time</button>
                    <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-criar-time-local">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- üö® NOVO: Modal Ver Pedidos Urgentes (para profissionais) -->
    <div id="modal-pedidos-urgentes-profissional" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Pedidos Urgentes Dispon√≠veis</h3>
                <button class="btn-close-modal" data-modal="modal-pedidos-urgentes-profissional">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 8px; flex: 1;">
                        <i class="fas fa-filter"></i>
                        <select id="filtro-categoria-pedidos" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color);">
                            <option value="">Todas as categorias</option>
                            <option value="montagem">Montagem</option>
                            <option value="pintura">Pintura</option>
                            <option value="eletricista">Eletricista</option>
                            <option value="encanador">Encanador</option>
                            <option value="jardinagem">Jardinagem</option>
                            <option value="limpeza">Limpeza</option>
                            <option value="outros">Outros</option>
                        </select>
                    </label>
                    <button id="btn-filtrar-pedidos" class="btn-primary">
                        <i class="fas fa-search"></i> Filtrar
                    </button>
                </div>
                <div id="lista-pedidos-urgentes" class="lista-propostas">
                    <p>Carregando pedidos...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- üö® NOVO: Modal Meus Pedidos Urgentes (para clientes) -->
    <div id="modal-meus-pedidos-urgentes" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Meus Pedidos Urgentes</h3>
                <button class="btn-close-modal" data-modal="modal-meus-pedidos-urgentes">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 8px; flex: 1;">
                        <i class="fas fa-filter"></i>
                        <select id="filtro-status-meus-pedidos" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color);">
                            <option value="">Todos os status</option>
                            <option value="aberto">Abertos</option>
                            <option value="aceito">Aceitos</option>
                            <option value="concluido">Conclu√≠dos</option>
                            <option value="cancelado">Cancelados</option>
                        </select>
                    </label>
                    <button id="btn-filtrar-meus-pedidos" class="btn-primary">
                        <i class="fas fa-search"></i> Filtrar
                    </button>
                </div>
                <div id="lista-meus-pedidos-urgentes" class="lista-propostas">
                    <p>Carregando seus pedidos...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- üö® NOVO: Modal Enviar Proposta R√°pida -->
    <div id="modal-enviar-proposta" class="modal-overlay hidden">
        <div class="modal-content">
            <h2><i class="fas fa-hand-holding-usd"></i> Enviar Proposta R√°pida</h2>
            <form id="form-enviar-proposta">
                <input type="hidden" id="proposta-pedido-id">
                <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="proposta-valor" placeholder="0.00" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Tempo de Chegada</label>
                    <select id="proposta-tempo-chegada" required>
                        <option value="">Selecione...</option>
                        <option value="Agora">Agora</option>
                        <option value="15 min">15 minutos</option>
                        <option value="30 min">30 minutos</option>
                        <option value="1 hora">1 hora</option>
                        <option value="2 horas">2 horas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes (opcional)</label>
                    <textarea id="proposta-observacoes" placeholder="Adicione informa√ß√µes sobre sua proposta..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Enviar Proposta</button>
                    <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-enviar-proposta">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚ö° NOVO: Modal Criar Vaga-Rel√¢mpago (para empresas) -->
    <div id="modal-vaga-relampago" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-bolt"></i> Criar Vaga-Rel√¢mpago</h2>
            <form id="form-vaga-relampago">
                <div class="form-group">
                    <label>T√≠tulo da Vaga</label>
                    <input type="text" id="vaga-titulo" placeholder="Ex: Preciso de 2 Gar√ßons" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea id="vaga-descricao" placeholder="Descreva a vaga e o que ser√° necess√°rio..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Cargo</label>
                    <input type="text" id="vaga-cargo" placeholder="Ex: Gar√ßom, Carregador, Vendedor" required>
                </div>
                <div class="form-group">
                    <label>Quantidade de Pessoas</label>
                    <input type="number" id="vaga-quantidade" placeholder="Ex: 2" min="1" required>
                </div>
                <div class="form-group">
                    <label>Data do Servi√ßo</label>
                    <input type="date" id="vaga-data" required>
                </div>
                <div class="form-group">
                    <label>Hor√°rio</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="time" id="vaga-hora-inicio" placeholder="In√≠cio" required>
                        <input type="time" id="vaga-hora-fim" placeholder="Fim" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Valor por Pessoa (R$)</label>
                    <input type="number" id="vaga-valor" placeholder="0.00" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Forma de Pagamento</label>
                    <select id="vaga-forma-pagamento" required>
                        <option value="via_helpy">Via Helpy</option>
                        <option value="direto">Direto (na hora)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Endere√ßo</label>
                    <input type="text" id="vaga-endereco" placeholder="Rua, n√∫mero, bairro" required>
                </div>
                <div class="form-group">
                    <label>Cidade</label>
                    <input type="text" id="vaga-cidade" required>
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <select id="vaga-estado" required>
                        <option value="">Selecione...</option>
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AP">AP</option>
                        <option value="AM">AM</option>
                        <option value="BA">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MT">MT</option>
                        <option value="MS">MS</option>
                        <option value="MG">MG</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PR">PR</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="RJ">RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SP">SP</option>
                        <option value="SE">SE</option>
                        <option value="TO">TO</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane"></i> Publicar Vaga
                    </button>
                    <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-vaga-relampago">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚ö° NOVO: Modal Ver Vagas-Rel√¢mpago (para profissionais) -->
    <div id="modal-vagas-relampago-profissional" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-briefcase"></i> Vagas-Rel√¢mpago Dispon√≠veis</h2>
            <div id="lista-vagas-relampago" class="lista-propostas">
                <p>Carregando vagas...</p>
            </div>
        </div>
    </div>

    <!-- üí∞ NOVO: Modal Pagamento Seguro (Garantia Helpy) -->
    <div id="modal-pagamento-seguro" class="modal-overlay hidden">
        <div class="modal-content">
            <h2><i class="fas fa-shield-alt"></i> Pagamento Seguro - Garantia Helpy</h2>
            <div id="info-pagamento-seguro" style="margin-bottom: 20px; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                <p><strong id="servico-titulo-pagamento"></strong></p>
                <p id="servico-descricao-pagamento" style="font-size: 14px; color: var(--text-secondary);"></p>
            </div>
            <form id="form-pagamento-seguro">
                <input type="hidden" id="pagamento-tipo-servico">
                <input type="hidden" id="pagamento-servico-id">
                <input type="hidden" id="pagamento-valor">
                
                <div class="form-group">
                    <label>Valor do Servi√ßo</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px; font-weight: bold; color: var(--primary-color);">R$</span>
                        <input type="number" id="pagamento-valor-input" step="0.01" min="0" required readonly style="font-size: 20px; font-weight: bold;">
                    </div>
                </div>
                
                <div class="form-group" style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Taxa da Plataforma (5%):</span>
                        <span id="pagamento-taxa" style="font-weight: bold;">R$ 0,00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Valor Total:</span>
                        <span id="pagamento-total" style="font-weight: bold; font-size: 18px; color: var(--primary-color);">R$ 0,00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 1px solid #c8e6c9;">
                        <span style="font-size: 12px; color: #666;">Profissional receber√°:</span>
                        <span id="pagamento-valor-liquido" style="font-weight: bold; color: #2e7d32;">R$ 0,00</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>M√©todo de Pagamento</label>
                    <select id="pagamento-metodo" required>
                        <option value="cartao_credito">Cart√£o de Cr√©dito</option>
                        <option value="cartao_debito">Cart√£o de D√©bito</option>
                        <option value="pix">PIX</option>
                        <option value="boleto">Boleto</option>
                    </select>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <i class="fas fa-shield-alt"></i> <strong>Garantia Helpy:</strong> Seu pagamento fica seguro at√© o servi√ßo ser conclu√≠do. 
                        Se o profissional n√£o aparecer, voc√™ recebe 100% do valor de volta.
                    </p>
                </div>
                
                <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #007bff;">
                    <p style="margin: 0; font-size: 14px; color: #004085;">
                        <i class="fas fa-star"></i> <strong>B√¥nus:</strong> O profissional receber√° XP em dobro por usar a Garantia Helpy!
                    </p>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-lock"></i> Pagar com Garantia Helpy
                    </button>
                    <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-pagamento-seguro">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- üí∞ NOVO: Modal Liberar Pagamento -->
    <div id="modal-liberar-pagamento" class="modal-overlay hidden">
        <div class="modal-content">
            <h2><i class="fas fa-check-circle"></i> Liberar Pagamento</h2>
            <div id="info-liberar-pagamento" style="margin-bottom: 20px;">
                <p>Confirme que o servi√ßo foi conclu√≠do com sucesso para liberar o pagamento ao profissional.</p>
                <div style="background: var(--bg-primary); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Valor do Servi√ßo:</span>
                        <strong id="liberar-valor-servico">R$ 0,00</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Taxa da Plataforma:</span>
                        <span id="liberar-taxa">R$ 0,00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 2px solid var(--border-color);">
                        <span><strong>Profissional receber√°:</strong></span>
                        <strong id="liberar-valor-liquido" style="color: var(--primary-color); font-size: 18px;">R$ 0,00</strong>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button id="btn-confirmar-liberar" class="btn-primary">
                    <i class="fas fa-check"></i> Sim, Liberar Pagamento
                </button>
                <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-liberar-pagamento">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- üí∞ NOVO: Modal Meus Pagamentos (Cliente) -->
    <div id="modal-meus-pagamentos" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-wallet"></i> Meus Pagamentos Seguros</h2>
            <div id="lista-pagamentos-cliente" class="lista-propostas">
                <p>Carregando pagamentos...</p>
            </div>
        </div>
    </div>

    <!-- üîî NOVO: Modal Notifica√ß√µes -->
    <div id="modal-notificacoes" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-bell"></i> Notifica√ß√µes</h2>
                <button id="btn-marcar-todas-lidas" class="btn-secondary" style="padding: 8px 15px;">
                    <i class="fas fa-check-double"></i> Marcar todas como lidas
                </button>
            </div>
            <div id="lista-notificacoes" class="lista-propostas" style="max-height: 500px; overflow-y: auto;">
                <p>Carregando notifica√ß√µes...</p>
            </div>
        </div>
    </div>

    <!-- ‚öñÔ∏è NOVO: Modal Criar Disputa -->
    <div id="modal-criar-disputa" class="modal-overlay hidden">
        <div class="modal-content">
            <h2><i class="fas fa-gavel"></i> Abrir Disputa</h2>
            <form id="form-criar-disputa">
                <input type="hidden" id="disputa-pagamento-id">
                <div class="form-group">
                    <label>Tipo de Disputa</label>
                    <select id="disputa-tipo" required>
                        <option value="">Selecione...</option>
                        <option value="cliente_nao_liberou">Cliente n√£o liberou o pagamento</option>
                        <option value="profissional_nao_executou">Profissional n√£o executou o servi√ßo</option>
                        <option value="servico_nao_conforme">Servi√ßo n√£o conforme com o combinado</option>
                        <option value="outro">Outro motivo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Motivo</label>
                    <textarea id="disputa-motivo" placeholder="Descreva detalhadamente o motivo da disputa..." required rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label>Evid√™ncias (URLs de imagens/comprovantes)</label>
                    <input type="text" id="disputa-evidencia-1" placeholder="URL da evid√™ncia 1 (opcional)">
                    <input type="text" id="disputa-evidencia-2" placeholder="URL da evid√™ncia 2 (opcional)" style="margin-top: 10px;">
                    <input type="text" id="disputa-evidencia-3" placeholder="URL da evid√™ncia 3 (opcional)" style="margin-top: 10px;">
                </div>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <i class="fas fa-info-circle"></i> <strong>Aten√ß√£o:</strong> Nossa equipe analisar√° sua disputa e entrar√° em contato em at√© 48 horas.
                    </p>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane"></i> Enviar Disputa
                    </button>
                    <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-criar-disputa">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚öñÔ∏è NOVO: Modal Minhas Disputas -->
    <div id="modal-minhas-disputas" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-gavel"></i> Minhas Disputas</h2>
            <div id="lista-disputas" class="lista-propostas">
                <p>Carregando disputas...</p>
            </div>
        </div>
    </div>

    <!-- üìà NOVO: Dashboard Administrativo -->
    <div id="modal-dashboard-admin" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-chart-line"></i> Dashboard Administrativo</h2>
            
            <!-- Estat√≠sticas Gerais -->
            <div id="admin-estatisticas" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <!-- Cards ser√£o preenchidos dinamicamente -->
            </div>

            <!-- Abas -->
            <div style="border-bottom: 2px solid var(--border-color); margin-bottom: 20px;">
                <button class="admin-tab-btn active" data-tab="pagamentos">Pagamentos</button>
                <button class="admin-tab-btn" data-tab="disputas">Disputas</button>
                <button class="admin-tab-btn" data-tab="financeiro">Financeiro</button>
            </div>

            <!-- Conte√∫do das Abas -->
            <div id="admin-tab-pagamentos" class="admin-tab-content active">
                <h3>Pagamentos Recentes</h3>
                <div id="admin-lista-pagamentos" class="lista-propostas">
                    <p>Carregando...</p>
                </div>
            </div>

            <div id="admin-tab-disputas" class="admin-tab-content">
                <h3>Disputas Abertas</h3>
                <div id="admin-lista-disputas" class="lista-propostas">
                    <p>Carregando...</p>
                </div>
            </div>

            <div id="admin-tab-financeiro" class="admin-tab-content">
                <h3>Resumo Financeiro</h3>
                <div id="admin-resumo-financeiro" style="background: var(--bg-primary); padding: 20px; border-radius: 8px;">
                    <p>Carregando...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- üí∞ NOVO: Modal Pagamentos Garantidos (Profissional) -->
    <div id="modal-pagamentos-garantidos" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-shield-alt"></i> Pagamentos Garantidos</h2>
            <div id="resumo-pagamentos-profissional" style="background: var(--bg-primary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">Total Recebido</p>
                        <p id="total-recebido" style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #28a745;">R$ 0,00</p>
                    </div>
                    <div>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">A Receber</p>
                        <p id="total-a-receber" style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #ffc107;">R$ 0,00</p>
                    </div>
                    <div>
                        <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">Total de Servi√ßos</p>
                        <p id="total-servicos" style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: var(--primary-color);">0</p>
                    </div>
                </div>
            </div>
            <div id="lista-pagamentos-profissional" class="lista-propostas">
                <p>Carregando pagamentos...</p>
            </div>
        </div>
    </div>

    <!-- ‚ö° NOVO: Modal Ver Candidatos (para empresas) -->
    <div id="modal-candidatos-vaga" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-users"></i> Candidatos da Vaga</h2>
            <div id="info-vaga-candidatos" style="margin-bottom: 20px; padding: 15px; background: var(--bg-primary); border-radius: 8px;">
                <p><strong id="vaga-titulo-candidatos"></strong></p>
                <p id="vaga-info-candidatos" style="font-size: 14px; color: var(--text-secondary);"></p>
            </div>
            <div id="lista-candidatos-vaga" class="lista-propostas">
                <p>Carregando candidatos...</p>
            </div>
            <div id="profissionais-aceitos-vaga" style="margin-top: 20px;">
                <h3 style="font-size: 16px; margin-bottom: 10px;">Profissionais Aceitos</h3>
                <div id="lista-aceitos-vaga" class="lista-propostas"></div>
            </div>
        </div>
    </div>

    <!-- üìã NOVO: Modal Criar Projeto de Time -->
    <div id="modal-projeto-time" class="modal-overlay hidden">
        <div class="modal-content modal-grande">
            <h2><i class="fas fa-project-diagram"></i> Criar Projeto de Time / Mutir√£o</h2>
            <form id="form-projeto-time">
                <div class="form-group">
                    <label>T√≠tulo do Projeto</label>
                    <input type="text" id="projeto-titulo" placeholder="Ex: Pintura de Pr√©dio" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea id="projeto-descricao" placeholder="Descreva o projeto..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="projeto-categoria" required>
                        <option value="">Selecione...</option>
                        <option value="construcao">Constru√ß√£o</option>
                        <option value="pintura">Pintura</option>
                        <option value="jardinagem">Jardinagem</option>
                        <option value="limpeza">Limpeza</option>
                        <option value="montagem">Montagem</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data do Servi√ßo</label>
                    <input type="date" id="projeto-data" required>
                </div>
                <div class="form-group">
                    <label>Hor√°rio</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="time" id="projeto-hora-inicio" placeholder="In√≠cio" required>
                        <input type="time" id="projeto-hora-fim" placeholder="Fim" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Endere√ßo</label>
                    <input type="text" id="projeto-endereco" placeholder="Rua, n√∫mero, bairro" required>
                </div>
                <div class="form-group">
                    <label>Cidade</label>
                    <input type="text" id="projeto-cidade" required>
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <select id="projeto-estado" required>
                        <option value="">Selecione...</option>
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AP">AP</option>
                        <option value="AM">AM</option>
                        <option value="BA">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MT">MT</option>
                        <option value="MS">MS</option>
                        <option value="MG">MG</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PR">PR</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="RJ">RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SP">SP</option>
                        <option value="SE">SE</option>
                        <option value="TO">TO</option>
                    </select>
                </div>
                <div id="profissionais-necessarios-container">
                    <label>Profissionais Necess√°rios</label>
                    <div id="profissionais-lista-projeto">
                        <div class="profissional-item-projeto">
                            <input type="text" placeholder="Tipo (ex: pintor)" class="tipo-profissional-projeto" required>
                            <input type="number" placeholder="Qtd" class="qtd-profissional-projeto" min="1" value="1" required>
                            <input type="number" placeholder="R$ por pessoa" class="valor-profissional-projeto" min="0" step="0.01" required>
                            <button type="button" class="btn-remover-profissional-projeto">&times;</button>
                        </div>
                    </div>
                    <button type="button" id="btn-adicionar-profissional-projeto" class="btn-secondary">
                        <i class="fas fa-plus"></i> Adicionar Profissional
                    </button>
                </div>
                <div class="form-group">
                    <label>Valor Total</label>
                    <input type="number" id="projeto-valor-total" placeholder="0.00" min="0" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Criar Projeto</button>
                    <button type="button" class="btn-secondary btn-close-modal" data-modal="modal-projeto-time">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts s√≥ s√£o carregados se o usu√°rio estiver autenticado -->
    <script>
        // Verifica novamente antes de carregar scripts
        (function() {
            const pathname = window.location.pathname || '';
            const isLoginPage = pathname === '/login' || 
                               pathname === '/cadastro' ||
                               pathname.endsWith('/login') || 
                               pathname.endsWith('/cadastro');
            
            if (!isLoginPage) {
                const token = localStorage.getItem('jwtToken');
                const userId = localStorage.getItem('userId');
                
                if (token && userId) {
                    // Usu√°rio autenticado - carrega scripts
                    const script1 = document.createElement('script');
                    script1.src = '/script.js';
                    document.body.appendChild(script1);
                    
                    const script2 = document.createElement('script');
                    script2.src = '/novas-funcionalidades.js';
                    document.body.appendChild(script2);
                } else {
                    // N√£o autenticado - n√£o carrega scripts, apenas redireciona
                    window.location.replace('/login');
                }
            }
        })();
    </script>
</body>
</html>

